---
title: "4.3.3. 协议错误"
anchor: "4.3.3_Protocol_Errors"
weight: 433
rank: "h3"
---

其他错误可能因为事务中畸形、不完整或意料外的消息而发生。
这包括（但不限于）：

* 客户端或服务器接收到了消息ID非零的消息

* 客户端或服务器在接收完由2字节的长度字段指定的完整消息数据前就接收到了流的FIN置位

* 客户端在接收到所有应该收到的响应前就遇到了流的FIN置位

* 服务器在一条流上接收到了多条查询

* 客户端在一条流上接收到的响应数量与预期不同（例如，对A记录的查询出现了数条响应）

* 客户端接收到了**停止发送帧**

* 客户端或服务器没有在发送完请求或响应后对流进行FIN置位（详见[第4.2章]()）

* 实现接收到了包含着`EDNS(0)`选项`edns-tcp-keepalive`（详见《[RFC7828]()》）的消息（详见[第5.5.2章]()）

* 客户端或服务器企图打开单向的QUIC流

* 服务器企图发起一条双向QUIC流

* 服务器在0-RTT数据中接收到了“可重放”的事务（但服务器不愿意处理这种情况，详见[第4.5章]()）

如果对端表现出了此类错误行为，那么终端会将此认为是致命的错误。
它**应该**使用QUIC的**连接关闭帧**机制来强行中止连接，并且**应该**使用DoQ错误码`DOQ_PROTOCOL_ERROR`。
在某些情况下，它**可以**静默地舍弃该连接，这种做法占用的本地资源更少，但是使得出错的对端处的调试变得更加困难。

注意，上述对于`EDNS(0)`选项的限制会影响从TCP/DoT/DoH向DoQ对消息进行代理。
